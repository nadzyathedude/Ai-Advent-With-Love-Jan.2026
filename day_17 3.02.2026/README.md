ðŸ”¥ Ð”ÐµÐ½ÑŒ 16. Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²

## Ð—Ð°Ð´Ð°Ñ‡Ð°

ÐŸÐ¾ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ð¿Ð°Ð¹Ð¿Ð»Ð°Ð¹Ð½, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹:
1. Ð Ð°Ð·Ð±Ð¸Ð²Ð°ÐµÑ‚ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð½Ð° Ñ‡Ð°Ð½ÐºÐ¸
2. Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð¸ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ñ‡Ð°Ð½ÐºÐ°
3. Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ JSON-Ð¸Ð½Ð´ÐµÐºÑ Ñ Ñ‡Ð°Ð½ÐºÐ°Ð¼Ð¸ Ð¸ ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð°Ð¼Ð¸

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½Ð´ÐµÐºÑ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð°Ð¼Ð¸ Ð² JSON-Ñ„Ð°Ð¹Ð»Ðµ.

---

## ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

```
indexer/
â”œâ”€â”€ __init__.py      # Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ñ‹ Ð¿Ð°ÐºÐµÑ‚Ð°
â”œâ”€â”€ config.py        # ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ (dataclasses)
â”œâ”€â”€ chunker.py       # Ð§Ð°Ð½ÐºÐ¸Ð½Ð³ Ñ‚ÐµÐºÑÑ‚Ð° Ñ Ð¿ÐµÑ€ÐµÐºÑ€Ñ‹Ñ‚Ð¸ÐµÐ¼
â”œâ”€â”€ embeddings.py    # ÐŸÑ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€ ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð¾Ð² (OpenAI, Ñ€Ð°ÑÑˆÐ¸Ñ€ÑÐµÐ¼Ñ‹Ð¹)
â”œâ”€â”€ index.py         # Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ JSON-Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼
â””â”€â”€ pipeline.py      # Ð“Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ð¾Ñ€ÐºÐµÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ Ð¿Ð°Ð¹Ð¿Ð»Ð°Ð¹Ð½Ð°

main.py              # CLI Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
requirements.txt     # Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
```

---

## Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
python3 -m venv venv
source venv/bin/activate

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
pip install -r requirements.txt

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ API ÐºÐ»ÑŽÑ‡
export OPENAI_API_KEY="sk-..."
```

---

## Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ

### CLI

```bash
# Ð˜Ð½Ð´ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð´Ð¸Ð½ Ñ„Ð°Ð¹Ð»
python main.py file document.txt

# Ð˜Ð½Ð´ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ„Ð°Ð¹Ð»Ð¾Ð²
python main.py file doc1.txt doc2.txt doc3.txt

# Ð˜Ð½Ð´ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ (Ð²ÑÐµ .txt Ñ„Ð°Ð¹Ð»Ñ‹)
python main.py dir ./documents

# Ð ÐµÐºÑƒÑ€ÑÐ¸Ð²Ð½Ð¾ Ñ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð¾Ð¼
python main.py dir ./documents --pattern "*.md" --recursive

# ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
python main.py file doc.txt --chunk-size 1000 --overlap 200 --output my_index.json

# Ð¢ÐµÐºÑÑ‚ Ð¸Ð· stdin
echo "Your text here" | python main.py text --doc-id my_doc
```

### ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð½Ñ‹Ð¹ API

```python
from indexer import IndexingPipeline, PipelineConfig, ChunkingConfig

# Ð‘Ð°Ð·Ð¾Ð²Ð¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ
pipeline = IndexingPipeline()
pipeline.add_text("Ð’Ð°Ñˆ Ñ‚ÐµÐºÑÑ‚ Ð·Ð´ÐµÑÑŒ", document_id="doc1")
pipeline.add_file("document.txt")
pipeline.save("index.json")

# Ð¡ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÐµÐ¹
config = PipelineConfig(
    chunking=ChunkingConfig(chunk_size=1000, chunk_overlap=200)
)
pipeline = IndexingPipeline(config)
```

---

## ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ

| ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ | ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|----------|--------------|----------|
| `chunk_size` | 800 | Ð Ð°Ð·Ð¼ÐµÑ€ Ñ‡Ð°Ð½ÐºÐ° Ð² ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°Ñ… |
| `chunk_overlap` | 150 | ÐŸÐµÑ€ÐµÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð¼ÐµÐ¶Ð´Ñƒ Ñ‡Ð°Ð½ÐºÐ°Ð¼Ð¸ |
| `model` | text-embedding-3-small | ÐœÐ¾Ð´ÐµÐ»ÑŒ ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð¾Ð² OpenAI |
| `batch_size` | 64 | Ð Ð°Ð·Ð¼ÐµÑ€ Ð±Ð°Ñ‚Ñ‡Ð° Ð´Ð»Ñ API Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² |
| `output` | document_index.json | ÐŸÑƒÑ‚ÑŒ Ðº Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ð¾Ð¼Ñƒ Ñ„Ð°Ð¹Ð»Ñƒ |

---

## Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ JSON-Ð¸Ð½Ð´ÐµÐºÑÐ°

```json
{
  "schema_version": "1.0",
  "created_at": "2026-02-13T10:36:07.635076+00:00",
  "embedding_model": "text-embedding-3-small",
  "documents": [
    {
      "document_id": "README",
      "source": "path/to/file.md",
      "chunks": [
        {
          "chunk_id": "README_chunk_0_c5d650da",
          "text": "chunk text here...",
          "embedding": [0.0123, -0.0456, ...],
          "metadata": {
            "start_char": 0,
            "end_char": 800
          }
        }
      ]
    }
  ]
}
```

---

## ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸

- **Ð”ÐµÑ‚ÐµÑ€Ð¼Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ID Ñ‡Ð°Ð½ÐºÐ¾Ð²** â€” ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ñ…ÐµÑˆÐ¸ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°
- **UTF-8 Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°** â€” ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ ÐºÐ¸Ñ€Ð¸Ð»Ð»Ð¸Ñ†ÐµÐ¹ Ð¸ ÑÐ¼Ð¾Ð´Ð·Ð¸
- **Ð‘Ð°Ñ‚Ñ‡Ð¸Ð½Ð³** â€” ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ API Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ (32-128 Ñ‡Ð°Ð½ÐºÐ¾Ð² Ð·Ð° Ñ€Ð°Ð·)
- **Retry Ñ backoff** â€” ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚ÑŒ Ðº Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ð¼ API
- **Ð Ð°ÑÑˆÐ¸Ñ€ÑÐµÐ¼Ð¾ÑÑ‚ÑŒ** â€” Ð°Ð±ÑÑ‚Ñ€Ð°ÐºÑ‚Ð½Ñ‹Ð¹ `EmbeddingProvider` Ð´Ð»Ñ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð¾Ð²

---

## Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸

- Python 3.10+
- openai >= 1.0.0
